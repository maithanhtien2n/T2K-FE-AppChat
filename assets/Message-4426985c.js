import{_ as le,K as ae,u as re,T as ce,L as ie,k as _,p as $,q as ue,M as b,N as a,c as y,d as r,e as t,g as n,f as w,O as q,P as de,Q as me,E as k,A as T,R as _e,w as pe,F as S,o as c,C as Q,B as W,U as he,G as ge,H as fe,I as ve}from"./index-9aff8ca2.js";import{u as xe}from"./index-4c82eef0.js";const J="/assets/image-1-380e6bf8.webp";const p=h=>(fe("data-v-5b54268a"),h=h(),ve(),h),be={style:{padding:"4rem 0"},class:"relative h-full"},ye={style:{"border-bottom":"1px solid #f1f1f1"},class:"absolute z-5 top-0 right-0 left-0 w-full h-4rem bg-white flex justify-content-between align-items-center px-3"},we={class:"flex gap-3 align-items-center"},ke={style:{"font-size":"0.9rem"},class:"text-700"},Se={key:0,class:"w-full chat-container flex flex-column gap-3 justify-content-end",style:{"min-height":"100%"}},Ce=p(()=>t("div",{class:"w-full text-center text-2xl font-bold py-8"}," Bắt đầu cuộc trò chuyện ",-1)),Te={class:"flex gap-1"},Me={src:J,alt:"Lỗi ảnh",class:"object-fit-cover",style:{width:"1.5rem",height:"1.5rem"}},Ie={key:0,class:"relative h-8rem max-w-15rem border-1 text-200 on-click mb-1 border-round-2xl overflow-hidden"},Re=["src"],je={class:"absolute top-0 left-0 right-0 bottom-0 opacity-0"},ze=["src","onClick"],Fe=["innerHTML"],He={key:0,class:"relative w-full text-right"},Ae=["src"],Be={key:1,class:"w-full flex"},Ge={class:"flex gap-2"},De=p(()=>t("img",{class:"object-fit-cover",style:{width:"1.5rem",height:"1.5rem"},src:J,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,-1)),Le={class:"flex flex-column gap-1"},Ne=p(()=>t("span",{style:{"font-size":"0.8rem"},class:"text-800"},"Đang nhập tin nhắn ",-1)),Ue={key:1,class:"w-full chat-container flex justify-content-center align-items-center",style:{"min-height":"100%"}},Ee={class:"flex flex-column justify-content-center gap-3"},Ke=p(()=>t("span",{class:"text-800"},"Đang tải tin nhắn . . .",-1)),Oe={style:{"border-top":"1px solid #f1f1f1"},class:"absolute z-5 bottom-0 right-0 left-0 w-full bg-white flex align-items-center"},Pe={class:"chat-container w-full"},Ve={class:"w-full flex gap-2 align-items-center"},$e={style:{"background-color":"#f1f1f1"},class:"w-full p-3 border-round-3xl flex gap-2"},qe=["onKeypress"],Qe=p(()=>t("i",{class:"pi pi-image text-800"},null,-1)),We={__name:"Message",setup(h){const X=ae(),C=re(),Y=ce(),{onGetterGroupMessage:l,onActionGetGroupMessage:Z}=ie(),i=xe("id","",{transform:String}),g=_(""),u=_(null),M=_(!1),d=_(null),I=_(null),ee=s=>{const o=new FileReader;o.readAsDataURL(s.target.files[0]),o.onload=m=>{u.value={name:s.target.files[0].name,base64:m.target.result},setTimeout(()=>{d.value.scrollTop=d.value.scrollHeight},1)}},te=()=>{u.value=null},R=()=>{var s;X.name==="Message"&&Z({account_id:(s=a.value)==null?void 0:s.account_id,room_id:i.value}).then(o=>{o.success||C.replace({name:"NotFound"})})},se=()=>{var s;b.emit("chat-message",{room_id:i.value,sender:(s=a.value)==null?void 0:s.account_id,content:"focus"})},oe=()=>{var s;b.emit("chat-message",{room_id:i.value,sender:(s=a.value)==null?void 0:s.account_id,content:"unfocus"})},j=async()=>{var s,o;b.emit("chat-message",{room_id:i.value,room_name:(s=l==null?void 0:l.value)==null?void 0:s.room_name,sender:(o=a.value)==null?void 0:o.account_id,content:g.value,image:u.value}),g.value="",u.value=null,I.value.blur()};return $(()=>l.value,()=>{setTimeout(()=>{d.value.scrollTop=d.value.scrollHeight},1)}),$(()=>i.value,()=>{R()}),ue(()=>{b.on(`chat-message-${i.value}`,({message:s,data:o})=>{var m,f;if(setTimeout(()=>{var v;d.value.scrollTop=(v=d.value)==null?void 0:v.scrollHeight},1),(s==null?void 0:s.type)==="sending"){M.value=s.active&&(s==null?void 0:s.sender)!==((m=a.value)==null?void 0:m.account_id);return}((f=l==null?void 0:l.value)==null?void 0:f.room_name)!==(o==null?void 0:o.room_name)&&Y.info(o==null?void 0:o.content,o==null?void 0:o.room_name),l.value=s}),R()}),(s,o)=>{var z,F,H,A;const m=y("Avatar"),f=y("Image"),v=y("Skeleton"),ne=y("ProgressSpinner");return c(),r("div",be,[t("div",ye,[t("div",we,[t("i",{class:"pi pi-home text-2xl on-click text-800",onClick:o[0]||(o[0]=e=>n(C).push({name:"Home"}))}),w(m,{value:{image:"",name:(z=n(l))==null?void 0:z.room_name}},{default:q(()=>{var e,x;return[t("span",ke,Q((x=(e=n(l))==null?void 0:e.members)==null?void 0:x.length)+" thành viên ",1)]}),_:1},8,["value"])]),t("div",null,[t("i",{class:"pi pi-spin pi-cog text-2xl on-click",onClick:o[1]||(o[1]=e=>n(C).push({name:"SettingMessage",params:{id:n(i)}}))})])]),t("div",{style:{"overflow-y":"auto"},class:"scroll-container w-full h-full pb-2",ref_key:"scrollContainer",ref:d},[(H=(F=n(l))==null?void 0:F.messages)!=null&&H.length?(c(),r("div",Se,[Ce,(c(!0),r(de,null,me((A=n(l))==null?void 0:A.messages,(e,x)=>{var B,G,D,L,N,U,E,K,O,P;return c(),r("div",{key:x,class:S(["w-full flex align-items-center",{"justify-content-end":((B=e==null?void 0:e.sender)==null?void 0:B._id)===((G=n(a))==null?void 0:G.account_id)}])},[t("div",Te,[T(t("img",Me,null,512),[[W,((D=e==null?void 0:e.sender)==null?void 0:D._id)!==((L=n(a))==null?void 0:L.account_id)]]),t("div",{class:S(["flex flex-column gap-1",((N=e==null?void 0:e.sender)==null?void 0:N._id)===((U=n(a))==null?void 0:U.account_id)?"align-items-end":"align-items-start"])},[T(t("span",{style:{"font-size":"0.8rem"},class:"text-800"},Q(n(he)(e==null?void 0:e.createdAt,!0)),513),[[W,((E=e==null?void 0:e.sender)==null?void 0:E._id)!==((K=n(a))==null?void 0:K.account_id)]]),e!=null&&e.image?(c(),r("div",Ie,[t("img",{class:"w-full h-full object-fit-cover",src:e==null?void 0:e.image,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,8,Re),t("div",je,[w(f,{src:e==null?void 0:e.image,alt:"Image",preview:""},{preview:q(V=>[t("img",{src:e==null?void 0:e.image,alt:"preview",class:"preview-image bg-white",style:ge(V.style),onClick:V.onClick},null,12,ze)]),_:2},1032,["src"])])])):k("",!0),e!=null&&e.content?(c(),r("span",{key:1,class:S([[((O=e==null?void 0:e.sender)==null?void 0:O._id)===((P=n(a))==null?void 0:P.account_id)?"bg-main-color-opacity":"bg-color-ddd"],"border-round-3xl text-900 max-w-18rem line-height-2 text-center"]),style:{padding:"0.5rem 0.8rem","word-wrap":"break-word","min-width":"3rem"},innerHTML:e==null?void 0:e.content},null,10,Fe)):k("",!0)],2)])],2)}),128)),u.value?(c(),r("div",He,[t("i",{style:{"font-size":"0.8rem",top:"0.5rem",right:"0.5rem"},class:"absolute pi pi-times on-click p-1 border-circle",onClick:te}),t("img",{style:{"max-width":"15rem"},class:"h-8rem border-round-2xl object-fit-cover border-1 text-400 p-disabled",src:u.value.base64,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,8,Ae)])):k("",!0),M.value?(c(),r("div",Be,[t("div",Ge,[De,t("div",Le,[Ne,w(v,{width:"10rem",height:"2rem",class:"border-round-3xl"})])])])):k("",!0)])):(c(),r("div",Ue,[t("div",Ee,[w(ne,{style:{width:"50px",height:"50px"},strokeWidth:"3",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),Ke])]))],512),t("div",Oe,[t("div",Pe,[t("div",Ve,[t("div",$e,[T(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>g.value=e),type:"text",ref_key:"inputField",ref:I,placeholder:"Nhập tin nhắn",class:"flex-1 border-none outline-none bg-transparent",onFocus:se,onBlur:oe,onKeypress:pe(j,["enter"])},null,40,qe),[[_e,g.value]]),t("div",{class:S(["relative overflow-hidden",{"p-disabled":u.value}])},[Qe,t("input",{type:"file",accept:"image/*",class:"absolute top-0 left-0 right-0 bottom-0 opacity-0",onChange:ee},null,32)],2)]),t("i",{class:"pi pi-caret-right text-main-color text-2xl on-click",onClick:j})])])])])}}},Ye=le(We,[["__scopeId","data-v-5b54268a"]]);export{Ye as default};
