import{_ as re,K as ce,u as ie,T as ue,L as de,k as _,p as q,q as me,M as k,N as a,c as h,d as r,e as t,g as n,f as g,O as Q,P as _e,Q as pe,E as f,A as M,R as he,w as ge,F as S,o as c,C as W,B as J,U as fe,G as ve,H as xe,I as ye}from"./index-d432a870.js";import{u as be}from"./index-32d29bff.js";const X="/assets/image-1-380e6bf8.webp";const p=v=>(xe("data-v-f8c53560"),v=v(),ye(),v),we={style:{padding:"4rem 0"},class:"relative h-full"},ke={style:{"border-bottom":"1px solid #f1f1f1"},class:"absolute z-5 top-0 right-0 left-0 w-full h-4rem bg-white flex justify-content-between align-items-center px-3"},Se={class:"flex gap-3 align-items-center"},Ce={style:{"font-size":"0.9rem"},class:"text-700"},Te={key:0,class:"w-full chat-container flex flex-column gap-3 justify-content-end",style:{"min-height":"100%"}},Me=p(()=>t("div",{class:"w-full text-center text-2xl font-bold py-8"}," Bắt đầu cuộc trò chuyện ",-1)),Ie={class:"flex gap-1"},je={src:X,alt:"Lỗi ảnh",class:"object-fit-cover",style:{width:"1.5rem",height:"1.5rem"}},Re={key:0,class:"relative h-8rem max-w-15rem border-1 text-200 on-click mb-1 border-round-2xl overflow-hidden"},Be=["src"],ze={class:"absolute top-0 left-0 right-0 bottom-0 opacity-0"},Fe=["src","onClick"],He=["innerHTML"],Ae={key:0,class:"relative w-full text-right"},Ge=["src"],De={key:1,class:"w-full flex justify-content-end"},Le={class:"w-14rem text-right flex flex-column gap-1 text-600"},Ne=p(()=>t("span",{class:"text-custom-mini"},"Đang gửi tin nhắn...",-1)),Pe={key:2,class:"w-full flex"},Ue={class:"flex gap-2"},Ee=p(()=>t("img",{class:"object-fit-cover",style:{width:"1.5rem",height:"1.5rem"},src:X,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,-1)),Ke={class:"flex flex-column gap-1"},Oe=p(()=>t("span",{style:{"font-size":"0.8rem"},class:"text-800"},"Đang nhập tin nhắn ",-1)),Ve={key:1,class:"w-full chat-container flex justify-content-center align-items-center",style:{"min-height":"100%"}},$e={class:"flex flex-column justify-content-center gap-3"},qe=p(()=>t("span",{class:"text-800"},"Đang tải tin nhắn . . .",-1)),Qe={style:{"border-top":"1px solid #f1f1f1"},class:"absolute z-5 bottom-0 right-0 left-0 w-full bg-white flex align-items-center"},We={class:"chat-container w-full"},Je={class:"w-full flex gap-2 align-items-center"},Xe={style:{"background-color":"#f1f1f1"},class:"w-full p-3 border-round-3xl flex gap-2"},Ye=["onKeypress"],Ze=p(()=>t("i",{class:"pi pi-image text-800"},null,-1)),et={__name:"Message",setup(v){const Y=ce(),C=ie(),Z=ue(),{onGetterGroupMessage:l,onActionGetGroupMessage:ee}=de(),i=be("id","",{transform:String}),x=_(""),u=_(null),I=_(!1),T=_(!1),d=_(null),j=_(null),te=s=>{const o=new FileReader;o.readAsDataURL(s.target.files[0]),o.onload=m=>{u.value={name:s.target.files[0].name,base64:m.target.result},setTimeout(()=>{d.value.scrollTop=d.value.scrollHeight},1)}},se=()=>{u.value=null},R=()=>{var s;Y.name==="Message"&&ee({account_id:(s=a.value)==null?void 0:s.account_id,room_id:i.value}).then(o=>{o.success||C.replace({name:"NotFound"})})},oe=()=>{var s;k.emit("chat-message",{room_id:i.value,sender:(s=a.value)==null?void 0:s.account_id,content:"focus"})},ne=()=>{var s;k.emit("chat-message",{room_id:i.value,sender:(s=a.value)==null?void 0:s.account_id,content:"unfocus"})},B=async()=>{var s,o;T.value=!0,k.emit("chat-message",{room_id:i.value,room_name:(s=l==null?void 0:l.value)==null?void 0:s.room_name,sender:(o=a.value)==null?void 0:o.account_id,content:x.value,image:u.value}),x.value="",u.value=null,j.value.blur()};return q(()=>l.value,()=>{setTimeout(()=>{d.value.scrollTop=d.value.scrollHeight},1)}),q(()=>i.value,()=>{R()}),me(()=>{k.on(`chat-message-${i.value}`,({message:s,data:o})=>{var m,y;if(setTimeout(()=>{var b;d.value.scrollTop=(b=d.value)==null?void 0:b.scrollHeight},1),(s==null?void 0:s.type)==="sending"){I.value=s.active&&(s==null?void 0:s.sender)!==((m=a.value)==null?void 0:m.account_id);return}((y=l==null?void 0:l.value)==null?void 0:y.room_name)!==(o==null?void 0:o.room_name)&&Z.info(o==null?void 0:o.content,o==null?void 0:o.room_name),T.value=!1,l.value=s}),R()}),(s,o)=>{var z,F,H,A;const m=h("Avatar"),y=h("Image"),b=h("ProgressBar"),le=h("Skeleton"),ae=h("ProgressSpinner");return c(),r("div",we,[t("div",ke,[t("div",Se,[t("i",{class:"pi pi-home text-2xl on-click text-800",onClick:o[0]||(o[0]=e=>n(C).push({name:"Home"}))}),g(m,{value:{image:"",name:(z=n(l))==null?void 0:z.room_name}},{default:Q(()=>{var e,w;return[t("span",Ce,W((w=(e=n(l))==null?void 0:e.members)==null?void 0:w.length)+" thành viên ",1)]}),_:1},8,["value"])]),t("div",null,[t("i",{class:"pi pi-spin pi-cog text-2xl on-click",onClick:o[1]||(o[1]=e=>n(C).push({name:"SettingMessage",params:{id:n(i)}}))})])]),t("div",{style:{"overflow-y":"auto"},class:"scroll-container w-full h-full pb-2",ref_key:"scrollContainer",ref:d},[(H=(F=n(l))==null?void 0:F.messages)!=null&&H.length?(c(),r("div",Te,[Me,(c(!0),r(_e,null,pe((A=n(l))==null?void 0:A.messages,(e,w)=>{var G,D,L,N,P,U,E,K,O,V;return c(),r("div",{key:w,class:S(["w-full flex align-items-center",{"justify-content-end":((G=e==null?void 0:e.sender)==null?void 0:G._id)===((D=n(a))==null?void 0:D.account_id)}])},[t("div",Ie,[M(t("img",je,null,512),[[J,((L=e==null?void 0:e.sender)==null?void 0:L._id)!==((N=n(a))==null?void 0:N.account_id)]]),t("div",{class:S(["flex flex-column gap-1",((P=e==null?void 0:e.sender)==null?void 0:P._id)===((U=n(a))==null?void 0:U.account_id)?"align-items-end":"align-items-start"])},[M(t("span",{style:{"font-size":"0.8rem"},class:"text-800"},W(n(fe)(e==null?void 0:e.createdAt,!0)),513),[[J,((E=e==null?void 0:e.sender)==null?void 0:E._id)!==((K=n(a))==null?void 0:K.account_id)]]),e!=null&&e.image?(c(),r("div",Re,[t("img",{class:"w-full h-full object-fit-cover",src:e==null?void 0:e.image,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,8,Be),t("div",ze,[g(y,{src:e==null?void 0:e.image,alt:"Image",preview:""},{preview:Q($=>[t("img",{src:e==null?void 0:e.image,alt:"preview",class:"preview-image bg-white",style:ve($.style),onClick:$.onClick},null,12,Fe)]),_:2},1032,["src"])])])):f("",!0),e!=null&&e.content?(c(),r("span",{key:1,class:S([[((O=e==null?void 0:e.sender)==null?void 0:O._id)===((V=n(a))==null?void 0:V.account_id)?"bg-main-color-opacity":"bg-color-ddd"],"border-round-3xl text-900 max-w-18rem line-height-2 text-center"]),style:{padding:"0.5rem 0.8rem","word-wrap":"break-word","min-width":"3rem"},innerHTML:e==null?void 0:e.content},null,10,He)):f("",!0)],2)])],2)}),128)),u.value?(c(),r("div",Ae,[t("i",{style:{"font-size":"0.8rem",top:"0.5rem",right:"0.5rem"},class:"absolute pi pi-times on-click p-1 border-circle",onClick:se}),t("img",{style:{"max-width":"15rem"},class:"h-8rem border-round-2xl object-fit-cover border-1 text-400 p-disabled",src:u.value.base64,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,8,Ge)])):f("",!0),T.value?(c(),r("div",De,[t("div",Le,[Ne,g(b,{mode:"indeterminate",style:{height:"23px"}})])])):f("",!0),I.value?(c(),r("div",Pe,[t("div",Ue,[Ee,t("div",Ke,[Oe,g(le,{width:"10rem",height:"2rem",class:"border-round-3xl"})])])])):f("",!0)])):(c(),r("div",Ve,[t("div",$e,[g(ae,{style:{width:"50px",height:"50px"},strokeWidth:"3",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),qe])]))],512),t("div",Qe,[t("div",We,[t("div",Je,[t("div",Xe,[M(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>x.value=e),type:"text",ref_key:"inputField",ref:j,placeholder:"Nhập tin nhắn",class:"flex-1 border-none outline-none bg-transparent",onFocus:oe,onBlur:ne,onKeypress:ge(B,["enter"])},null,40,Ye),[[he,x.value]]),t("div",{class:S(["relative overflow-hidden",{"p-disabled":u.value}])},[Ze,t("input",{type:"file",accept:"image/*",class:"absolute top-0 left-0 right-0 bottom-0 opacity-0",onChange:te},null,32)],2)]),t("i",{class:"pi pi-caret-right text-main-color text-2xl on-click",onClick:B})])])])])}}},ot=re(et,[["__scopeId","data-v-f8c53560"]]);export{ot as default};
