import{_ as ie,K as ue,u as de,T as me,L as _e,k as _,p as X,q as pe,M as T,N as r,c as f,d as i,e as t,g as l,f as v,O as Y,P as he,Q as ge,E as x,A as R,R as fe,w as ve,F as M,o as u,C as Z,B as ee,U as xe,G as ye,H as be,I as we}from"./index-539aa613.js";import{u as ke}from"./index-18ef82de.js";const te="/assets/image-1-380e6bf8.webp";const p=y=>(be("data-v-cec1d921"),y=y(),we(),y),Se={style:{padding:"4rem 0"},class:"relative h-full"},Ce={style:{"border-bottom":"1px solid #f1f1f1"},class:"absolute z-5 top-0 right-0 left-0 w-full h-4rem bg-white flex justify-content-between align-items-center px-3"},Te={class:"flex gap-3 align-items-center"},Me={style:{"font-size":"0.9rem"},class:"text-700"},Ie={key:0,class:"w-full chat-container flex flex-column gap-3 justify-content-end",style:{"min-height":"100%"}},je=p(()=>t("div",{class:"w-full text-center text-2xl font-bold py-8"}," Bắt đầu cuộc trò chuyện ",-1)),Re={class:"flex gap-1"},Be={src:te,alt:"Lỗi ảnh",class:"object-fit-cover",style:{width:"1.5rem",height:"1.5rem"}},Fe={key:0,class:"relative h-8rem max-w-15rem border-1 text-200 on-click mb-1 border-round-2xl overflow-hidden"},ze=["src"],Ae={class:"absolute top-0 left-0 right-0 bottom-0 overflow-hidden opacity-0"},Ge=["src","onClick"],He=["innerHTML"],De={key:0,class:"relative w-full text-right"},Le=["src"],Ne={key:1,class:"w-full flex justify-content-end"},Pe={class:"w-10rem text-right flex flex-column gap-1 text-600"},Ue=p(()=>t("span",{class:"text-custom-mini"},"Đang gửi tin nhắn...",-1)),Ee={key:2,class:"w-full flex"},Ke={class:"flex gap-2"},Oe=p(()=>t("img",{class:"object-fit-cover",style:{width:"1.5rem",height:"1.5rem"},src:te,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,-1)),Ve={class:"flex flex-column gap-1"},$e=p(()=>t("span",{class:"text-600 text-custom-mini"},"Đang nhập tin nhắn...",-1)),qe={key:1,class:"w-full chat-container flex justify-content-center align-items-center",style:{"min-height":"100%"}},Qe={class:"flex flex-column justify-content-center gap-3"},We=p(()=>t("span",{class:"text-800"},"Đang tải tin nhắn . . .",-1)),Je={style:{"border-top":"1px solid #f1f1f1"},class:"absolute z-5 bottom-0 right-0 left-0 w-full bg-white flex align-items-center"},Xe={class:"chat-container w-full"},Ye={class:"w-full flex gap-2 align-items-center"},Ze={style:{"background-color":"#f1f1f1"},class:"w-full p-3 border-round-3xl flex gap-2"},et=["onKeypress"],tt=p(()=>t("i",{class:"pi pi-image text-800"},null,-1)),st={__name:"Message",setup(y){const se=ue(),I=de(),oe=me(),{onGetterGroupMessage:n,onActionGetGroupMessage:ne}=_e(),d=ke("id","",{transform:String}),h=_(""),m=_(null),B=_(!1),j=_(!1),g=_(null),F=_(null),b=()=>{g.value.scrollTop=g.value.scrollHeight},le=s=>{const o=new FileReader;o.readAsDataURL(s.target.files[0]),o.onload=a=>{m.value={name:s.target.files[0].name,base64:a.target.result},setTimeout(()=>{b()},1)}},ae=()=>{m.value=null},z=()=>{var s;se.name==="Message"&&ne({account_id:(s=r.value)==null?void 0:s.account_id,room_id:d.value}).then(o=>{o.success||I.replace({name:"NotFound"})})},ce=()=>{var s;T.emit("chat-message",{room_id:d.value,sender:(s=r.value)==null?void 0:s.account_id,content:"focus"})},re=()=>{var s;T.emit("chat-message",{room_id:d.value,sender:(s=r.value)==null?void 0:s.account_id,content:"unfocus"})},A=async()=>{var s,o;(h.value||m.value)&&(j.value=!0,setTimeout(()=>{b()},1)),T.emit("chat-message",{room_id:d.value,room_name:(s=n==null?void 0:n.value)==null?void 0:s.room_name,sender:(o=r.value)==null?void 0:o.account_id,content:h.value,image:m.value}),h.value="",m.value=null,F.value.blur()};return X(()=>n.value,()=>{setTimeout(()=>{b()},1)}),X(()=>d.value,()=>{z()}),pe(()=>{var s,o;T.on(`chat-message-${d.value}`,({message:a,data:c})=>{var w,k;if(setTimeout(()=>{var S;g.value.scrollTop=(S=g.value)==null?void 0:S.scrollHeight},1),(a==null?void 0:a.type)==="sending"){B.value=a.active&&(a==null?void 0:a.sender)!==((w=r.value)==null?void 0:w.account_id);return}((k=n==null?void 0:n.value)==null?void 0:k.room_name)!==(c==null?void 0:c.room_name)&&oe.info(c==null?void 0:c.content,c==null?void 0:c.room_name),j.value=!1,n.value=a}),(!((s=n.value)!=null&&s._id)||((o=n.value)==null?void 0:o._id)!==d.value)&&z(),b()}),(s,o)=>{var G,H,D,L,N;const a=f("Avatar"),c=f("Image"),w=f("ProgressBar"),k=f("Skeleton"),S=f("ProgressSpinner");return u(),i("div",Se,[t("div",Ce,[t("div",Te,[t("i",{class:"pi pi-home text-2xl on-click text-800",onClick:o[0]||(o[0]=e=>l(I).push({name:"Home"}))}),v(a,{value:{image:((G=l(n))==null?void 0:G.room_image)||"images/icon-room.png",name:(H=l(n))==null?void 0:H.room_name,loading:!0}},{default:Y(()=>{var e,C;return[t("span",Me,Z((C=(e=l(n))==null?void 0:e.members)==null?void 0:C.length)+" thành viên ",1)]}),_:1},8,["value"])]),t("div",null,[t("i",{class:"pi pi-spin pi-cog text-2xl on-click",onClick:o[1]||(o[1]=e=>l(I).push({name:"SettingMessage",params:{id:l(d)}}))})])]),t("div",{style:{"overflow-y":"auto"},class:"scroll-container w-full h-full pb-2",ref_key:"scrollContainer",ref:g},[(L=(D=l(n))==null?void 0:D.messages)!=null&&L.length?(u(),i("div",Ie,[je,(u(!0),i(he,null,ge((N=l(n))==null?void 0:N.messages,(e,C)=>{var P,U,E,K,O,V,$,q,Q,W;return u(),i("div",{key:C,class:M(["w-full flex align-items-center",{"justify-content-end":((P=e==null?void 0:e.sender)==null?void 0:P._id)===((U=l(r))==null?void 0:U.account_id)}])},[t("div",Re,[R(t("img",Be,null,512),[[ee,((E=e==null?void 0:e.sender)==null?void 0:E._id)!==((K=l(r))==null?void 0:K.account_id)]]),t("div",{class:M(["flex flex-column gap-1",((O=e==null?void 0:e.sender)==null?void 0:O._id)===((V=l(r))==null?void 0:V.account_id)?"align-items-end":"align-items-start"])},[R(t("span",{style:{"font-size":"0.8rem"},class:"text-800"},Z(l(xe)(e==null?void 0:e.createdAt,!0)),513),[[ee,(($=e==null?void 0:e.sender)==null?void 0:$._id)!==((q=l(r))==null?void 0:q.account_id)]]),e!=null&&e.image?(u(),i("div",Fe,[t("img",{class:"w-full h-full object-fit-cover",src:e==null?void 0:e.image,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,8,ze),t("div",Ae,[v(c,{src:e==null?void 0:e.image,alt:"Image",preview:""},{preview:Y(J=>[t("img",{src:e==null?void 0:e.image,alt:"preview",class:"preview-image bg-white",style:ye(J.style),onClick:J.onClick},null,12,Ge)]),_:2},1032,["src"])])])):x("",!0),e!=null&&e.content?(u(),i("span",{key:1,class:M([[((Q=e==null?void 0:e.sender)==null?void 0:Q._id)===((W=l(r))==null?void 0:W.account_id)?"bg-main-color-opacity":"bg-color-ddd"],"border-round-3xl text-900 max-w-18rem line-height-2"]),style:{padding:"0.5rem 0.8rem","word-wrap":"break-word","min-width":"3rem"},innerHTML:e==null?void 0:e.content},null,10,He)):x("",!0)],2)])],2)}),128)),m.value?(u(),i("div",De,[t("i",{style:{"font-size":"0.8rem",top:"0.5rem",right:"0.5rem"},class:"absolute pi pi-times on-click p-1 border-circle",onClick:ae}),t("img",{style:{"max-width":"15rem"},class:"h-8rem border-round-2xl object-fit-cover border-1 text-400 p-disabled",src:m.value.base64,onerror:"this.onerror=null; this.src='../../../public/images/icon-image-error.png';"},null,8,Le)])):x("",!0),j.value?(u(),i("div",Ne,[t("div",Pe,[Ue,v(w,{mode:"indeterminate",style:{height:"23px"},class:"border-round-3xl"})])])):x("",!0),B.value?(u(),i("div",Ee,[t("div",Ke,[Oe,t("div",Ve,[$e,v(k,{width:"10rem",height:"23px",class:"border-round-3xl"})])])])):x("",!0)])):(u(),i("div",qe,[t("div",Qe,[v(S,{style:{width:"50px",height:"50px"},strokeWidth:"3",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),We])]))],512),t("div",Je,[t("div",Xe,[t("div",Ye,[t("div",Ze,[R(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>h.value=e),type:"text",ref_key:"inputField",ref:F,placeholder:"Nhập tin nhắn",class:"flex-1 border-none outline-none bg-transparent",onFocus:ce,onBlur:re,onKeypress:ve(A,["enter"])},null,40,et),[[fe,h.value]]),t("div",{class:M(["relative overflow-hidden",{"p-disabled":m.value}])},[tt,t("input",{type:"file",accept:"image/*",class:"absolute top-0 left-0 right-0 bottom-0 opacity-0",onChange:le},null,32)],2)]),t("i",{class:"pi pi-caret-right text-main-color text-2xl on-click",onClick:A})])])])])}}},lt=ie(st,[["__scopeId","data-v-cec1d921"]]);export{lt as default};
